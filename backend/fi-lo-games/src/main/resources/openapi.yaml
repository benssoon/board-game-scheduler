openapi: 3.1.1
info:
  title: Fi-Lo-Games API
  version: '1.0.0'
  description: |
    API Description here

servers:
  - url: http://localhost:8080/

paths:
  /authenticated:
    get:
      summary: Stuurt huidige gebruiker terug.
      tags:
        - Authentication
      description: Haal de gegevens van de ingelogde gebruiker op.
      responses:
        "200":
          description: Een JSON object met belangrijke informatie over de huidig ingelogde gebruiker.
          content:
            application/json:
              schema:
                type: object
                properties:
                  schema:
                    $ref: '#/components/schemas/authorities'
                  details:
                    type: object
                    properties:
                      remoteAddress:
                        type: string
                      sessionId:
                        type: integer
                  authenticated:
                    type: boolean
                  principal:
                    type: object
                    properties:
                      password:
                        type: string
                      username:
                        type: string
                      schema:
                        $ref: "#/components/schemas/authorities"
                      accountNonExpired:
                        type: boolean
                      accountNonLocked:
                        type: boolean
                      credentialsNonExpired:
                        type: boolean
                      enabled:
                        type: boolean
                  credentials:
                    type: string
                  name:
                    type: string


  /authenticate:
    post:
      summary: Inloggen
      tags:
        - Authentication
      description: Gebruik deze endpoint om inloggegevens op te sturen. Er moet een gebruikersnaam en een wachtwoord gestuurd worden. en bij kloppende gegevens ontvangt de client een response met de code 200.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
      responses:
        "200":
          description: Een json object met daarin een jwt.
          content:
            application/json:
              schema:
                type: object
                properties:
                  jwt:
                    type: string


  /events:
    post:
      summary: Nieuw Event
      tags:
        - Events
      description: Maak een nieuw Event aan. De gebruiker moet ingelogd zijn en de ROLE_USER authority hebben.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/eventNew'
      responses:
        "201":
          description: Stuurt alle gegevens van het net aangemaakte evenement terug.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/event'
        "400":
          description: Bad request. Stuurt terug welke waardes aangepast moeten worden.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/eventNew/required'

    get:
      summary: Alle Events
      tags:
        - Events
      description: Haal alle Events uit de database op.
      parameters:
        - in: query
          name: gameId
          schema:
            type: integer
            required: false
            description: Numeriek ID van een spel. Wordt gebruikt om evenementen te tonen met dat spel (of spellen met soortgelijke titels).
      responses:
        "200":
          description: Een JSON array van alle Event objecten.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/event'

  /events/{id}:
    get:
      summary: Eén Event
      tags:
        - Events
      description: Haal één evenement op.
      parameters:
        - in: path
          name: id
          schema:
            type: integer
            minimum: 1
          required: true
          description: Numeriek ID van het evenement dat gezocht wordt.
      responses:
        "200":
          description: Een JSON object met alle gegevens van het evenement.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/event'

    patch:
      summary: Event gegevens
      tags:
        - Events
      description: Pas (een deel van) de gegevens van een Event aan. De gebruiker moet ingelogd zijn en de ROLE_USER authority hebben.
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
            minimum: 1
          required: true
          description: Numeriek ID van het evenement dat aangepast wordt.
      responses:
        "200":
          description: Een JSON object met alle gegevens van het evenement.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/event'

    delete:
      summary: Event
      tags:
        - Events
      description: Verwijder een evenement. De gebruiker moet ingelogd zijn en de ROLE_ADMIN authority hebben.
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
            minimum: 1
          required: true
          description: Numeriek ID van het evenement dat verwijderd wordt.
      responses:
        "200":
          description: Een bericht dat het verwijderen succesvol is geweest.
          content:
            text/plain:
              type: string

  /events/{eventId}/game/{gameId}:
    put:
      summary: Koppel Event met Game
      tags:
        - Events
      description: Zet het spel voor een evenement. De gebruiker moet ingelogd zijn en de ROLE_USER authority hebben.
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: eventId
          schema:
            type: integer
            minimum: 1
          required: true
          description: Numeriek ID van het evenement.
        - in: path
          name: gameId
          schema:
            type: integer
            minimum: 1
          required: true
          description: Numeriek ID van het spel.
      responses:
        "200":
          description: Een JSON object met alle gegevens van het evenement.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/event'

  /events/{eventId}/add-player/{username}:
    post:
      summary: Voeg speler toe
      tags:
        - Events
      description: Voeg een User toe als speler van het evenement. De gebruiker moet ingelogd zijn en de ROLE_USER of ROLE_ADMIN authority hebben.
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: eventId
          schema:
            type: integer
            minimum: 1
          required: true
          description: Numeriek ID van het evenement.
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: Gebruikersnaam van de gebruiker die toegevoegd wordt.
      responses:
        "200":
          description: Een JSON object met alle gegevens van het evenement.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/event'

  /events/{eventId}/remove-player/{username}:
    post:
      summary: Verwijder speler
      tags:
        - Events
      description: Verwijder één van de spelers van het evenement. De gebruiker moet ingelogd zijn en de ROLE_USER of ROLE_ADMIN authority hebben.
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: eventId
          schema:
            type: integer
            minimum: 1
          required: true
          description: Numeriek ID van het evenement.
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: Gebruikersnaam van de gebruiker die verwijderd wordt.
      responses:
        "200":
          description: Een JSON object met alle gegevens van het evenement.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/event'

  /events/{eventId}/join:
    post:
      summary: Voeg zelf toe
      tags:
        - Events
      description: Hiermee kan een User zich aanmelden als een speler van het evenement. De gebruiker moet ingelogd zijn en de ROLE_USER authority hebben.
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: eventId
          schema:
            type: integer
            minimum: 1
          required: true
          description: Numeriek ID van het evenement.
      responses:
        "200":
          description: Een JSON object met alle gegevens van het evenement.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/event'

  /events/{eventId}/leave:
    post:
      summary: Zelf afmelden van Event
      tags:
        - Events
      description: Hiermee kan een User zich afmelden als speler van het evenement. De gebruiker moet ingelogd zijn en de ROLE_USER authority hebben.
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: eventId
          schema:
            type: integer
            minimum: 1
          required: true
          description: Numeriek ID van het evenement.
      responses:
        "200":
          description: Een JSON object met alle gegevens van het evenement.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/event'

  /events/deleteAll:
    delete:
      summary: Alle Events verwijderen
      tags:
        - Events
      description: Deze endpoint verwijderd alle Events behalve die met ID=1. De gebruiker moet ingelogd zijn en de ROLE_ADMIN authority hebben.
      security:
        - bearerAuth: [ ]
      responses:
        "200":
          description: Een bericht dat het verwijderen succesvol is geweest.
          content:
            text/plain:
              type: string


  /games:
    post:
      summary: Nieuw Game
      tags:
        - Games
      description: Maak een nieuw Game aan. De gebruiker moet ingelogd zijn en de ROLE_USER of ROLE_ADMIN authority hebben.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/gameNew'
      responses:
        "201":
          description: Stuurt alle gegevens van het net aangemaakte spel terug.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/game'
        "400":
          description: Bad request. Stuurt terug welke waardes aangepast moeten worden.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/gameNew/required'
    get:
      summary: Alle Games
      tags:
        - Games
      description: Haal alle spellen uit de database op.
      parameters:
        - in: query
          name: title
          schema:
            type: string
            required: false
            description: De titel van een spel. Haalt ook spellen met soortgelijke titels op.
      responses:
        "200":
          description: Een lijst van alle (matchende) spellen.
          content:
            application/json:
              type: array
              items:
                schema:
                  $ref: '#/components/schemas/game'
    delete:
      summary: Alle Games
      tags:
        - Games
      description: Verwijder alle spellen uit de database behalve die met ID=1. De gebruiker moet de ROLE_ADMIN authority hebben.
      security:
        - bearerAuth: [ ]
      responses:
        "200":
          description: Een bericht dat het verwijderen succesvol is geweest.
          content:
            text/plain:
              type: string

  /games/{id}:
    get:
      summary: Een Game
      tags:
        - Games
      description: Haal één spel uit de database op.
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: De ID van het gewenste spel.
      responses:
        "200":
          description: Stuurt alle gegevens van het gewenste spel terug.
          content:
            application/json:
              type: object
              schema:
                $ref: '#/components/schemas/game'
    put:
      summary: Volledige update
      tags:
        - Games
      description: Update een spel. Dit is een volledige update, dus alle gegevens die niet gestuurd zijn, worden leeg. De gebruiker moet de ROLE_ADMIN authority hebben.
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: De ID van het om te updaten spel.
      responses:
        "200":
          description: Stuurt alle gegevens van het geüpdatete spel terug.
          content:
            application/json:
              type: object
              schema:
                $ref: '#/components/schemas/game'
    delete:
      summary: Verwijder een Game
      tags:
        - Games
      description: Verwijdert een specifiek spel. De gebruiker moet de ROLE_ADMIN authority hebben.
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: De ID van het om te verwijderen spel.
      responses:
        "200":
          description: Een bericht dat het verwijderen succesvol is geweest.
          content:
            text/plain:
              type: string

  /games/{id}/forceDelete:
    delete:
      summary: Game en Events verwijderen
      tags:
        - Games
      description: Verwijdert een spel en alle evenementen waar hij mee gekoppeld is. De gebruiker moet de ROLE_ADMIN authority hebben.
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: De ID van het om te verwijderen spel.
      responses:
        "200":
          description: Een bericht dat het verwijderen succesvol is geweest.
          content:
            text/plain:
              type: string


  /users:
    post:
      summary: Nieuwe User
      tags:
        - Users
      description: Maak een nieuwe gebruiker aan.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/gameNew'
      responses:
        "201":
          description: Stuurt alle gegevens van het net aangemaakte spel terug.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/game'
    get:
      summary: Alle Users
      tags:
        - Users
      description: Haal alle gebruikers uit de database op.
      responses:
        "200":
          description: Stuurt een lijst van alle gebruikers terug, met alleen hun openbare informatie.
          content:
            application/json:
              type: array
              items:
                schema:
                  $ref: '#/components/schemas/userPublic'

  /users/{username}:
    parameters:
      - in: path
        name: username
        schema:
          type: string
        required: true
        description: De gebruikersnaam
    get:
      summary: Een User
      tags:
        - Users
      description: Haal de gegevens van één User uit de databse op. Als de gebruiker is ingelogd en zijn eigen gebruikersnaam meegeeft, krijgt hij zijn eigen gegevens terug. Anders krijgt hij de openbare gegevens van de gezochte gebruiker.
      security:
        - bearerAuth: [ ]
      responses:
        "200":
          description: De eigen gebruikersgegevens als ingelogd en {username} is hetzelfde als de eigen gebruikersnaam. Anders de openbare gebruikersgegevens.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/userPublic'
                  - $ref: '#/components/schemas/userPrivate'
    put:
      summary: Volledige update
      tags:
        - Users
      description: Update de eigen gebruikersgegevens. Dit is een volledige update, dus alle gegevens die niet gestuurd zijn, worden leeg. De gebruiker moet ingelogd zijn.
      security:
        - bearerAuth: [ ]
      requestBody:
        description: Alle gebruikersgegevens.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/newUser'
      responses:
        "200":
          description: Stuurt alle gegevens van de gebruiker terug, behalve het wachtwoord.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/userPrivate'
    patch:
      summary: Gedeeltelijke update
      tags:
        - Users
      description: Update (een deel van) de eigen gebruikersgegevens. Alle gegevens mogen aangepast worden behalve de gebruikersnaam. De gebruiker moet ingelogd zijn.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Stuurt alle gegevens van de gebruiker terug, behalve het wachtwoord.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/userPrivate'
    delete:
      summary: Verwijder User
      tags:
        - Users
      description: Verwijder een gebruiker. De verwijderende gebruiker moet de ROLE_ADMIN authority hebben en kan zichzelf niet verwijderen.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Een bericht dat het verwijderen succesvol is geweest.
          content:
            text/plain:
              type: string
              
  /users/{username}/roles:
    parameters:
      - in: path
        name: username
        required: true
        description: De gebruikersnaam van de gezochte gebruiker.
        schema:
          type: string
    get:
      summary: Gebruikersrollen
      tags:
        - Users
        - Roles
      description: Haal alle gebruikersrollen van een gebruiker op. De uitvoerende gebruiker moet de ROLE_ADMIN authority hebben.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Een lijst van alle rollen van de gezochte gebruiker.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/role'
    post:
      summary: Voeg nieuwe rol toe
      tags:
        - Users
        - Roles
      description: Hiermee kan een Admin een nieuwe rol geven aan zichzelf of een andere gebruiker. De uitvoerende gebruiker moet de ROLE_ADMIN authority hebben.
      security:
        - bearerAuth: []
      responses:
        "204":
          description: De rol is succesvol toegevoegd.

  /users/{username}/roles/{role}:
    delete:
      summary: Verwijder een gebruikersrol
      tags:
        - Users
        - Roles
      description: Gebruik deze endpoint om een rol van een gebruiker te verwijderen. De uitvoerende gebruiker moet de ROLE_ADMIN authority hebben en kan zijn eigen ROLE_ADMIN authority niet verwijderen. Mocht hij dat willen, dan moet een andere gebruiker met de ROLE_ADMIN authority zijn ROLE_ADMIN authority verwijderen.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: username
          required: true
          description: De gebruikersnaam van de gezochte gebruiker.
          schema:
            type: string
        - in: path
          name: role
          required: true
          description: De naam van de rol om te verwijderen.
          schema:
            type: string
      responses:
        "204":
          description: De rol is succesvol verwijderd.

  /images/upload:
    post:
      summary: Upload een profile picture.
      tags:
        - Images
      description: Om een afbeelding te uploaden als profile picture moet een gebruiker de ROLE_USER of ROLE_ADMIN authority hebben.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: De afbeelding is succesvol geupload. Stuurt de naam van het bestand terug.
          content:
            text/plain:
              type: string

  /images/{filename}:
    get:
      summary: Haal een afbeelding op.
      tags:
        - Images
      description: Afbeeldingen zijn na uploaden openbaar.
      responses:
        "200":
          description: De afbeelding.
          content: image/png
        "500":
          description: Er is iets misgegaan in het ophalen van de afbeelding.
        "404":
          description: Afbeelding niet gevonden.



              ############################

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    authorities:
      type: array
      items:
        type: object
        properties:
          authority:
            type: string
    eventNew:
      type: object
      properties:
        name:
          type: string
        isFull:
          type: boolean
        isHostPlaying:
          type: boolean
        location:
          type: string
        definitiveTime:
          type: string
        gameId:
          type: integer
      required:
        - name
        - isHostPlaying
        - location
        - gameId
    event:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        game:
          $ref: '#/components/schemas/game'
        isFull:
          type: boolean
        isReadyToStart:
          type: boolean
        isHostPlaying:
          type: boolean
        definitiveTime:
          type: string
        possibleTimes:
          type: array
          items:
            type: string
        players:
          type: array
          items:
            type: string # The usernames of all participants in the event
        location:
          type: string
        host:
          $ref: '#/components/schemas/userPublic'
    eventShort:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
    game:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        minPlayers:
          type: integer
        maxPlayers:
          type: integer
        complexity:
          type: string
        minAge:
          type: integer
        maxAge:
          type: integer
        activeEvents:
          type: array
          items:
            $ref: '#/components/schemas/eventShort'
    gameNew:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        minPlayers:
          type: int
        maxPlayers:
          type: int
        complexity:
          type: string
        minAge:
          type: integer
        maxAge:
          type: integer
      required:
        - title
        - minPlayers
        - maxPlayers
        - minAge
        - maxAge
    userPublic:
      type: object
      properties:
        username:
          type: string
        name:
          type: string
        area:
          type: string
        hostedEvents:
          type: array
          items:
            $ref: '#/components/schemas/eventShort'
        joinedEvents:
          type: array
          items:
            $ref: '#/components/schemas/eventShort'
    userPrivate:
      type: object
      properties:
        username:
          type: string
        name:
          type: string
        emailAddress:
          type: string
        telephoneNumber:
          type: string
        age:
          type: integer
        area:
          type: string
        address:
          type: string
        hostedEvents:
          type: array
          items:
            $ref: '#/components/schemas/eventShort'
        joinedEvents:
          type: array
          items:
            $ref: '#/components/schemas/eventShort'
        roles:
          type: array
          items:
            $ref: '#/components/schemas/role'
    newUser:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
        name:
          type: string
        emailAddress:
          type: string
        telephoneNumber:
          type: string
        age:
          type: integer
        area:
          type: string
        address:
          type: string
        roles:
          type: array
          items:
            $ref: '#/components/schemas/role'
      required:
        - username
        - password
        - name
        - emailAddress
        - telephoneNumber
    role:
      type: object
      properties:
        username:
          type: string
        role:
          type: string #In the form of "ROLE_<TYPE>"